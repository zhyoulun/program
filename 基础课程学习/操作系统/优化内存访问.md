## 5.6 优化内存访问

内存访问是处理器执行的最慢的功能之一。编写需要高性能的汇编语言时，最好尽可能避免内存访问。

只要可能，最好把变量保存到处理器的寄存器中。处理器的寄存器访问是经过高度优化的，并且是处理数据的最快方式。

当不可能把所有应用程序数据都保存在寄存器中时，应该试图优化应用程序的内存访问。对于使用数据缓存的处理器来说，在内存中按照连续的顺序访问内存能够提供缓存命中率，因为内存块会一次被读取到缓存中。

大多数处理器都被优化为从数据段开始的位置，在特定的缓存块中读取和写入内存位置。在奔腾4处理器中，缓存块的长度是64位，如果定义的数据元素超过64位块的边界，就必须用两次缓存操作才能获取或者存储内存中的数据元素。

为了解决这个问题，Intel建议在定义数据时遵循下面这些原则：

- 按照16字节边界对准16位数据
- 对准32位数据使它的基址是4的倍数
- 对准64位数据使它的基址是8的倍数
- 避免很多小的数据传输，而是使用单一的大型数据传输
- 避免在堆栈中使用大的数据长度（比如80位和128位浮点值）

## cache line

cache分成多个组，每个组分成多个行，line size是cache的基本单位，从主存向cache迁移数据都是按照line size为单位替换的。比如line size为32Byte，那么迁移必须一次迁移32Byte到cache。

## 参考

- 汇编语言程序设计
- [计算机缓存Cache以及Cache Line详解](https://zhuanlan.zhihu.com/p/37749443)