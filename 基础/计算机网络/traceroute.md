![](/static/images/2101/p004.png)

traceroute程序的操作流程：

- 发送一份ttl字段为1的IP数据报给目的主机。处理这份数据报的第一个路由器将ttl值减1，丢弃该数据报，并发回一份超时ICMP报文。这样就得到该路径中的第一个路由器的地址
- 然后traceroute程序发送一份ttl=2的数据报，这样我们就可以得到第二个路由器的地址
- 继续这个过程直到该数据报到达目的主机
- 但是目的主机哪怕接收到ttl=1的IP数据报，也不会丢弃该数据报并产生一份超时ICMP报文，这是因为数据报已经到达了最终目的地
  - 如何判断是否已经到达目的主机了呢？traceroute程序发送一份UDP数据报给目的主机，但它选择一个不可能的值作为UDP端口号（大于30000），但目的主机的任何一个应用程序都不可能使用该端口。当该数据报到达时，将是目的主机的UDP模块产生一份端口不可达错误的ICMP报文。