## 基本概念

码率控制的基本原理是按照一定的编码策略动态调整编码器的编码参数，通过各个层次上的码率优化分配，最终调节编码器在单位时间内输出的比特数，使得实际输出码率与目标码率一致。

码率控制过程可以通过对图像组（group of picture，GOP）层、图像层、宏块层等不同层次上的码率控制来实现。

目前绝大多数码率控制算法都通过调整量化参数QP的大小控制目标码率。实际上，量化参数QP反应了图像空间细节的压缩情况。如果QP较小，图像的大部分细节都会被保留；相反，一些细节将会消失，导致输出码率降低，图像失真严重，质量下降。

也就是说QP和编码输出的码率成反比，而且随着视频信源复杂度的提高，这种反比关系也会更加明显。

同时，如果相邻宏块的QP相差较大，还可能造成相邻宏块之间出现明显的块效应，对于视频传输而言，这将严重影响主观视觉感知效果。

## 码率控制模式

不同的应用场合，对码率的需求不同，根据编码码率是否变化，可将码率控制分为两种模式：恒定码率（CBR，constant bit rate）和可变码率（VBR，variable bit rate）

### 恒定码率模式

在该模式下，无论是复杂的场景还是简单场景，都使用相同的码率，即编码码率与场景复杂度无关，这样就会造成复杂度场景的图像质量相对较低，而简单场景的图像质量相对较高，从而导致图像质量的波动。

对于CBR模式，比较常见的应用有VCD（video compact disk）存储，和数字电视广播。VCD采用MPEG-1编码标准，为了便于实现，规定其只能以恒定码率编码。它的视频编码码率规定为1.15Mbit/s，再加上音频信息，总计约为1.5Mbit/s。一个普通的CD的存储容量约为650MB，播放时间约为57分钟。此外，地面和卫星数字电视广播也需要在恒定码率模式下工作。对于MPEG-2数字电视来说，它的码率范围是5~10Mbit/s。

### 可变码率模式

在VBR模式下，输出码率会在一定范围内波动。根据对码率控制的严格程度，可以将VBR模式分为四类：U-VBR、S-VBR、C-VBR和F-VBR。

- 在U-VBR模式下，视频编码器和解码缓冲区以及用户网络接口无关，这类VBR可通过保持恒定量化步长得到。
- 对于编码器而言，S-VBR和U-VBR一样，不受解码缓冲区约束，但受网络传输模型限制，在平滑突发流量时需引入额外的时延。
- 在C-VBR模式下，通常认为传输的有效带宽不变，视频编码器按照场景复杂度控制码率，一定时间内的码率可以在零和最高码率之间调整。
- F-VBR是指编码器能够根据反馈的网络状态信息动态的调整编码参数，这就要求编码器能够实时获得网络的状况信息
- 实际应用中，S-VBR和U-VBR这两种模式由于不能很好地控制突发流量而很少使用；而C-VBR和F-VBR则根据各自的码率特点有着不同的应用

由于C-VBR模式允许码率在一定范围内变化，因此对于简单的场景可以使用较少的比特数，从而节省出一定的比特数预留给复杂的场景使用，在一定程度上保证了视频质量的相对稳定。

C-VBR模式主要应用于媒体存储，典型的应用就是DVD（digital video disk）。DVD采用MPEG-2编码，通常在编码过程中，只有长时间的平均码率限制，短时间内的码率可以随着画面系统和活动性的不同而有很大的变化，最高能达到10Mbit/s以上。

F-VBR模式下的码率可以根据网络状态信息实时调节。在无线网络等可用网络带宽不稳定的环境中，要求编码器在编码过程中能够根实时监控网络状态，估计网络有效带宽，动态调节当前时刻的码率。

